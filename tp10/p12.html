<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ejercicio 12 - CHAT</title>
<style>
body { font-family: Georgia, 'Times New Roman', serif; margin: 24px; }
h1 { font-size: 36px; margin: 0 0 16px; }
label { display: block; margin: 8px 0 6px; }
input[type="text"], textarea { width: 100%; max-width: 640px; font-family: 'Courier New', monospace; font-size: 16px; padding: 8px; border: 1px solid #aab4c1; border-radius: 4px; }
textarea { height: 140px; resize: vertical; }
.actions { margin: 10px 0 18px; }
button { padding: 8px 12px; font-size: 15px; cursor: pointer; }
hr { margin: 18px 0; border: none; border-top: 1px solid #cfd5de; max-width: 720px; }
#historial { max-width: 720px; white-space: pre-wrap; font-family: 'Courier New', monospace; }
.entry { margin: 10px 0; }
.datetime { color: #222; }
.author { font-weight: 700; }
.msg { display: block; margin-left: 0; }
.note { color: #666; font-size: 13px; }
</style>
</head>
<body>
<h1>CHAT</h1>

<form id="chat-form">
  <label for="nombre">Nombre</label>
  <input id="nombre" name="nombre" type="text" placeholder="Nombre" autocomplete="off" required>

  <label for="mensaje" style="margin-top:12px">Mensaje</label>
  <textarea id="mensaje" name="mensaje" placeholder="Escribe tu mensaje..."></textarea>

  <div class="actions">
    <button type="submit" id="btn-enviar">Enviar Mensaje</button>
    <span class="note">Sugerencia: Ctrl+Enter para enviar</span>
  </div>
</form>

<hr>
<div id="historial" aria-live="polite"></div>

<script>
(function () {
  const $ = (id) => document.getElementById(id);
  const form = $("chat-form");
  const nombre = $("nombre");
  const mensaje = $("mensaje");
  const historial = $("historial");

  const formatDate = (d) => {
    const fecha = d.toLocaleDateString("es-AR");
    const hora = d.toLocaleTimeString("es-AR", { hour12: false });
    return `${fecha} ${hora}`;
  };

  const appendEntry = (autor, texto) => {
    const time = formatDate(new Date());
    const entry = document.createElement("div");
    entry.className = "entry";
    entry.innerHTML = `<div class="datetime">${time} por <span class="author"></span></div>` +
                      `<span class="msg"></span>`;
    entry.querySelector('.author').textContent = autor || "Anónimo";
    entry.querySelector('.msg').textContent = texto;
    historial.appendChild(entry);
  };

  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const autor = (nombre.value || "").trim() || "Anónimo";
    const texto = (mensaje.value || "").trim();
    if (!texto) {
      mensaje.focus();
      return;
    }
    appendEntry(autor, texto);
    mensaje.value = ""; // limpiar contenido anterior
    mensaje.focus(); // posicionar el cursor en el textarea
  });

  mensaje.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && (e.ctrlKey || e.metaKey)) {
      e.preventDefault();
      form.requestSubmit();
    }
  });

  // Focus inicial en el textarea como en el ejemplo
  mensaje.focus();
})();
</script>
</body>
</html>
